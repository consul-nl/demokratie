<aside class='margin-bottom' id='sidebar'>

  <% content_block_sidebar_name = "budget_#{@budget.id}_phase_#{@budget.current_phase.id}_info" %>
  <% if render_custom_projekt_content_block?(content_block_sidebar_name, @projekt_phase.projekt) %>
    <%= render Shared::SidebarCardComponent.new(title: t("custom.proposals.index.participation_information"), icon_name: "info-circle") do |c| %>
      <%= render_custom_block content_block_sidebar_name %>
    <% end %>
  <% end %>

  <%= render "pages/projekt_footer_new/budget/my_ballot" %>

  <% unless @budget.current_phase.kind == 'publishing_prices' && @budget.show_results_after_first_vote? # con-1036 %>
    <% if params[:section].blank? || params[:section] == 'overview' %>
      <% if valid_filters&.any? %>
        <%= render Shared::SidebarCardComponent.new(title: "Filter", icon_name: "filter") do |c| %>
          <%= render Budgets::Investments::FiltersComponent.new %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <% if !params[:section].in? %w[stats results] %>
    <% if @budget.projekt_phase&.projekt_labels&.any? %>
      <%= render Shared::SidebarCardComponent.new(title: @budget.projekt_phase.projekt_labels_label_text, icon_name: "tags") do |c| %>
        <%= render Shared::ProjektLabelsComponent.new(projekt_phase_id: @budget.projekt_phase.id) %>
      <% end %>
    <% end %>

    <% if @budget.projekt_phase&.sentiments&.any? %>
      <%= render Shared::SidebarCardComponent.new(title: @budget.projekt_phase.sentiment_label_text, icon_name: "heart") do |c| %>
        <%= render Shared::SentimentsComponent.new(projekt_phase_id: @budget.projekt_phase.id) %>
      <% end %>
    <% end %>
  <% end %>

  <% if params[:section] == "stats" && can?(:read_stats, @budget) %>
    <% if @budget.selecting_or_later? %>
      <%= render Shared::SidebarCardComponent.new(title: "Filter", icon_name: "filter") do |c| %>
        <%= render Budgets::PhaseStats::FiltersComponent.new(@budget) %>
      <% end %>
    <% end %>

    <%= render Sidebar::ExportListComponent.new(
      path: read_stats_budget_path(@budget, **request.query_parameters, stats_section: params["stats_section"], format: :csv)
    ) %>
  <% end %>
</aside>
