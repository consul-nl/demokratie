(()=>{var{ClassicEditor:v,Plugin:w,ButtonView:h,icons:f,Dialog:F,View:d,InputTextView:p,ViewCollection:C}=CKEDITOR,_=class extends w{constructor(t){super(t),this.url="",this.apiGet=`${this.url}/ckeditor/assets`,this.apiUpload={picture:`${this.url}/ckeditor/pictures`,document:`${this.url}/ckeditor/documents`},this.fileAccept={picture:"image/*",document:""},this.apiPut=(e,i)=>`${this.apiUpload[e]}/${i}`,this.csrf_token=document.querySelector('meta[name="csrf-token"]')?document.querySelector('meta[name="csrf-token"]').content:"NXRqTpKQhE1fKecDK5REAmaFNsDfmmgnIzoRb5RvC-kJ4eMQ4sYp8uevjZkryQi20oNnyRnWNm9xSSVYx3K9lA",this.state={editor_id:t.sourceElement.id,type:"picture",page:1,search:"",total_pages:0,items:[],chosen:{},isLoading:!1,enableTargetBlank:!1}}get requires(){return[F]}static get pluginName(){return"UploadFilesPlugin"}init(){let t=this.editor;t.model.schema.extend("$text",{allowAttributes:["linkHref","linkTarget"]}),t.model.schema.register("a",{allowChildren:["imageBlock","imageInline","$text"],allowAttributes:["linkHref","linkTarget"]}),t.model.schema.extend("imageBlock",{allowIn:["a"]}),t.model.schema.extend("imageInline",{allowIn:["a"]}),t.model.schema.extend("paragraph",{allowChildren:["a"]}),t.conversion.for("downcast").attributeToElement({model:"linkTarget",view:(e,{writer:i})=>{if(e)return i.createAttributeElement("a",{target:e},{priority:5})}}),t.conversion.for("upcast").attributeToAttribute({view:{name:"a",key:"target"},model:"linkTarget"}),t.ui.componentFactory.add("uploadFiles",e=>{let i=new h(e);return i.set({label:"Dateien hochladen",icon:f.browseFiles,tooltip:!0}),i.on("execute",()=>{if(this.dialog=this.editor.plugins.get("Dialog"),i.isOn){this.dialog.hide(),i.isOn=!1;return}i.isOn=!0,this._createDialogContent(e),this.dialog.show({title:"Bilder- und Dokumenten Editor",content:this.dialogView,onHide:()=>{this.state={type:"picture",page:1,search:"",total_pages:0,items:[],chosen:{},isLoading:!1},i.isOn=!1}}),this._fetchFiles({type:this.state.type,page:this.state.page,search:this.state.search})}),i})}_createDialogContent(t){this.dialogView=new d(t),this._createSidebar(),this._createEditModal(),this._createFooter();let e=this._createMainPanel(t);this.dialogView.setTemplate({tag:"div",attributes:{style:{display:"flex",flexDirection:"column",whiteSpace:"initial",width:"90vw",maxWidth:"840px",height:"70vh"},class:"upldFls__wrapper ck-reset_all-excluded"},children:[{tag:"div",attributes:{class:"upldFls__inner"},children:[this.sidebarView,this.editModalView,e,this.footerView]}]})}_createFooter(){this.footerView=new d(this.editor.locale);let t=new h(this.editor.locale);t.set({label:"W\xE4hlen",withText:!0,class:"ck-button-action"}),t.on("execute",()=>{if(this.state.chosen.url){let e=this.editor,i=this.state.chosen;e.model.change(s=>{let c=e.model.document.selection,o=c.getSelectedElement();if(i.data_content_type.startsWith("image/")){let n={src:this.state.chosen.url,alt:this.state.chosen.alt_text||"Default alt text"};if(o&&["imageBlock","imageInline"].includes(o.name))s.setAttributes(n,o),s.setSelection(o,"on");else{let l=c.getFirstPosition(),a=null,u=e.model.schema.checkChild(l.parent,"imageBlock"),r=e.model.schema.checkChild(l.parent,"imageInline");if(u)a=s.createElement("imageBlock",n);else if(r)a=s.createElement("imageInline",n);else{let m=e.model.document.getRoot();l=s.createPositionAt(m,"end"),a=s.createElement("imageBlock",n)}this.state.enableTargetBlank,e.model.insertContent(a,l),s.setSelection(a,"on")}}else{let n={linkHref:i.url,...this.state.enableTargetBlank&&{linkTarget:"_blank"}},l=i.title||i.data_file_name||"File";if(o&&(o.is("imageBlock")||o.is("imageInline"))){let a=s.createText(l,n);s.insert(a,s.createRangeOn(o))}else{let a=s.createText(l,n);e.model.insertContent(a,c)}}})}this.dialog.hide()}),this.footerView.on("render",()=>{let e=this.footerView.element.querySelector(".updateTargetCheckbox");e&&e.addEventListener("change",i=>{this.state.enableTargetBlank=i.target.checked})}),this.footerView.setTemplate({tag:"div",attributes:{class:"upldFls__footer"},children:[{tag:"label",attributes:{class:"upldFls__footerCol"},children:[{tag:"input",attributes:{type:"checkbox",class:"ck-input ck-checkbox updateTargetCheckbox"},onExecute:e=>{console.log("change",e)}},"Dokument soll in neuem Fenster ge\xF6ffnet werden"]},t]})}_updateSidebarView(){this._createSidebar(),this.sidebarView&&this.sidebarView.isRendered===!1&&this.sidebarView.render();let t=this.dialogView.element.querySelector(".upldFls__inner > .ckbox-navbar");t&&t.replaceWith(this.sidebarView.element)}_createSidebar(){this.sidebarView=new d(this.editor.locale);let t=new h(this.editor.locale);t.set({label:"Bilder",tooltip:!0,icon:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M21.75 3.75H2.25C1.83516 3.75 1.5 4.08516 1.5 4.5V19.5C1.5 19.9148 1.83516 20.25 2.25 20.25H21.75C22.1648 20.25 22.5 19.9148 22.5 19.5V4.5C22.5 4.08516 22.1648 3.75 21.75 3.75ZM20.8125 18.5625H3.1875V17.6273L6.43359 13.7766L9.95156 17.9484L15.4242 11.4609L20.8125 17.85V18.5625ZM20.8125 15.5203L15.5672 9.3C15.4922 9.21094 15.3562 9.21094 15.2812 9.3L9.95156 15.6188L6.57656 11.618C6.50156 11.5289 6.36562 11.5289 6.29062 11.618L3.1875 15.2977V5.4375H20.8125V15.5203Z" fill="currentColor"/>
<path opacity="0.1" d="M9.95156 17.9484L6.43359 13.7766L3.1875 17.6273V18.5625H20.8125V17.85L15.4242 11.4609L9.95156 17.9484Z" fill="currentColor"/>
<path opacity="0.1" d="M3.1875 15.2977L6.29062 11.618C6.36562 11.5289 6.50156 11.5289 6.57656 11.618L9.95156 15.6188L15.2812 9.3C15.3562 9.21094 15.4922 9.21094 15.5672 9.3L20.8125 15.5203V5.4375H3.1875V15.2977ZM7.125 6.5625C7.39585 6.5625 7.66405 6.61585 7.91428 6.7195C8.16452 6.82315 8.39189 6.97507 8.58341 7.16659C8.77493 7.35811 8.92685 7.58548 9.0305 7.83572C9.13415 8.08595 9.1875 8.35415 9.1875 8.625C9.1875 8.89585 9.13415 9.16405 9.0305 9.41428C8.92685 9.66452 8.77493 9.89189 8.58341 10.0834C8.39189 10.2749 8.16452 10.4269 7.91428 10.5305C7.66405 10.6342 7.39585 10.6875 7.125 10.6875C6.57799 10.6875 6.05339 10.4702 5.66659 10.0834C5.2798 9.69661 5.0625 9.17201 5.0625 8.625C5.0625 8.07799 5.2798 7.55339 5.66659 7.16659C6.05339 6.7798 6.57799 6.5625 7.125 6.5625Z" fill="#currentColor"/>
<path opacity="0.1" d="M6.46875 8.625C6.46875 8.79905 6.53789 8.96597 6.66096 9.08904C6.78403 9.21211 6.95095 9.28125 7.125 9.28125C7.29905 9.28125 7.46597 9.21211 7.58904 9.08904C7.71211 8.96597 7.78125 8.79905 7.78125 8.625C7.78125 8.45095 7.71211 8.28403 7.58904 8.16096C7.46597 8.03789 7.29905 7.96875 7.125 7.96875C6.95095 7.96875 6.78403 8.03789 6.66096 8.16096C6.53789 8.28403 6.46875 8.45095 6.46875 8.625Z" fill="currentColor"/>
<path d="M7.125 10.6875C7.39585 10.6875 7.66405 10.6342 7.91428 10.5305C8.16452 10.4269 8.39189 10.2749 8.58341 10.0834C8.77493 9.89189 8.92685 9.66452 9.0305 9.41428C9.13415 9.16405 9.1875 8.89585 9.1875 8.625C9.1875 8.35415 9.13415 8.08595 9.0305 7.83572C8.92685 7.58548 8.77493 7.35811 8.58341 7.16659C8.39189 6.97507 8.16452 6.82315 7.91428 6.7195C7.66405 6.61585 7.39585 6.5625 7.125 6.5625C6.57799 6.5625 6.05339 6.7798 5.66659 7.16659C5.2798 7.55339 5.0625 8.07799 5.0625 8.625C5.0625 9.17201 5.2798 9.69661 5.66659 10.0834C6.05339 10.4702 6.57799 10.6875 7.125 10.6875ZM7.125 7.96875C7.48828 7.96875 7.78125 8.26172 7.78125 8.625C7.78125 8.98828 7.48828 9.28125 7.125 9.28125C6.76172 9.28125 6.46875 8.98828 6.46875 8.625C6.46875 8.26172 6.76172 7.96875 7.125 7.96875Z" fill="currentColor"/>
</svg>`,class:`upldFls__btnIcon ${this.state.type==="picture"?"active":""}`}),this.listenTo(t,"execute",()=>{this._handleTypeClick("picture"),i()});let e=new h(this.editor.locale);e.set({label:"Dokumente",tooltip:!0,icon:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M20.0297 6.76641C20.1703 6.90703 20.25 7.09687 20.25 7.29609V21.75C20.25 22.1648 19.9148 22.5 19.5 22.5H4.5C4.08516 22.5 3.75 22.1648 3.75 21.75V2.25C3.75 1.83516 4.08516 1.5 4.5 1.5H14.4539C14.6531 1.5 14.8453 1.57969 14.9859 1.72031L20.0297 6.76641ZM18.5203 7.64062L14.1094 3.22969V7.64062H18.5203ZM14.8411 14.9358C14.4853 14.9241 14.107 14.9515 13.6774 15.0052C13.1079 14.6538 12.7245 14.1713 12.4521 13.4623L12.4772 13.3596L12.5062 13.2382C12.607 12.8133 12.6612 12.5032 12.6773 12.1905C12.6895 11.9545 12.6764 11.7368 12.6345 11.535C12.5571 11.0993 12.2489 10.8445 11.8605 10.8288C11.4984 10.8141 11.1656 11.0163 11.0805 11.3297C10.942 11.8364 11.0231 12.5032 11.3168 13.6404C10.9427 14.5322 10.4484 15.5777 10.1168 16.1609C9.67406 16.3891 9.3293 16.5968 9.03961 16.827C8.65758 17.1309 8.41898 17.4434 8.35336 17.7715C8.32148 17.9236 8.36953 18.1223 8.47898 18.2852C8.6032 18.4699 8.79023 18.5899 9.01453 18.6073C9.58055 18.6511 10.2762 18.0675 11.0442 16.7496C11.1213 16.7238 11.2029 16.6966 11.3025 16.6629L11.5814 16.5687C11.7579 16.5091 11.8859 16.4665 12.0124 16.4255C12.5609 16.2469 12.9757 16.1341 13.353 16.0699C14.0088 16.421 14.7668 16.6512 15.2773 16.6512C15.6987 16.6512 15.9834 16.4327 16.0863 16.0889C16.1766 15.787 16.1051 15.4369 15.911 15.2433C15.7104 15.0462 15.3415 14.952 14.8411 14.9358ZM9.02883 17.9456V17.9372L9.03187 17.9292C9.06617 17.8406 9.11019 17.756 9.16313 17.677C9.26344 17.5228 9.40148 17.3606 9.57258 17.1879C9.66445 17.0953 9.76008 17.0051 9.87234 16.9038C9.89742 16.8813 10.0577 16.7386 10.0877 16.7105L10.3495 16.4667L10.1592 16.7698C9.87047 17.2301 9.60938 17.5615 9.38578 17.7776C9.30352 17.8573 9.23109 17.9159 9.1725 17.9536C9.15316 17.9665 9.13268 17.9777 9.11133 17.9869C9.10172 17.9909 9.09328 17.9932 9.08484 17.9939C9.07594 17.995 9.06689 17.9938 9.05859 17.9904C9.04977 17.9867 9.04224 17.9805 9.03694 17.9725C9.03165 17.9645 9.02882 17.9552 9.02883 17.9456ZM11.9805 12.8297L11.9276 12.9234L11.8948 12.8208C11.8221 12.5904 11.7687 12.2433 11.7539 11.9302C11.737 11.5739 11.7654 11.3602 11.8779 11.3602C12.0359 11.3602 12.1083 11.6133 12.1139 11.9941C12.1191 12.3288 12.0663 12.6771 11.9803 12.8297H11.9805ZM11.8444 14.1998L11.8802 14.1049L11.9292 14.194C12.2032 14.6918 12.5588 15.1071 12.9497 15.3966L13.0341 15.4589L12.9312 15.48C12.5484 15.5592 12.192 15.6783 11.7045 15.8749C11.7553 15.8543 11.1977 16.0826 11.0566 16.1367L10.9336 16.1838L10.9992 16.0695C11.2887 15.5655 11.5561 14.9604 11.8441 14.1998H11.8444ZM15.5386 15.9872C15.3544 16.0598 14.9578 15.9949 14.2596 15.6968L14.0824 15.6213L14.2746 15.6073C14.8207 15.5667 15.2074 15.5967 15.4329 15.6792C15.529 15.7144 15.593 15.7587 15.6213 15.8093C15.6363 15.8333 15.6413 15.8621 15.6353 15.8897C15.6294 15.9173 15.6129 15.9415 15.5895 15.9572C15.5746 15.9703 15.5573 15.9805 15.5386 15.9872Z" fill="currentColor"/>
</svg>`,class:`upldFls__btnIcon ${this.state.type==="document"?"active":""}`}),this.listenTo(e,"execute",()=>{this._handleTypeClick("document"),i()});let i=()=>{this.state.type==="picture"&&t.element?(t.element.classList.add("active"),e.element.classList.remove("active")):this.state.type==="document"&&e.element&&(e.element.classList.add("active"),t.element.classList.remove("active"))};i();let s=new p(this.editor.locale);s.set({value:this.state.search,placeholder:"Suchen..."}),s.bind("value").to(()=>this.state.search),s.on("input",l=>{this.state.search=l.source.element.value}),s.on("render",()=>{s.element.addEventListener("keydown",l=>{l.key==="Enter"&&this._handleSearchSubmit()})});let c=new h(this.editor.locale);c.set({label:"Cancel",withText:!1,class:"upldFls__iconDelete"}),this.listenTo(c,"execute",()=>{s.element.value="",this.state.search="",this._handleSearchSubmit()});let o=new h(this.editor.locale);o.set({label:"Bild editieren",withText:!0,class:"upldFls__btnPrimary"}),this.listenTo(o,"execute",()=>{this._updateEditModalView()});let n=new h(this.editor.locale);n.set({label:"Neues Bild / Dokument hochladen",withText:!0,class:"upldFls__btnPrimary"}),this.listenTo(n,"execute",()=>{let l=document.createElement("input");l.type="file",l.accept=this.fileAccept[this.state.type],l.click(),l.addEventListener("change",a=>{let u=a.target.files;if(u&&u.length>0){let r=new FormData;Array.from(u).forEach(m=>{r.append("upload",m)}),r.append("editor_id",this.state.editor_id),this._uploadFiles(r)}else console.log("No files selected")})}),this.sidebarView.setTemplate({tag:"div",attributes:{class:"ckbox-navbar upldFls__navbar"},children:[{tag:"div",attributes:{class:"upldFls__filterWrapper"},children:[{tag:"div",attributes:{class:"upldFls__searchWrapper"},children:[s,c,{tag:"span",attributes:{class:"upldFls__iconSearch"},children:[]}]},{tag:"span",children:["Filter:"]},t,e]},{tag:"div",attributes:{class:"upldFls__actionsWrapper"},children:[this.state.chosen&&Object.keys(this.state.chosen).length>0?o:"",n]}]})}_createEditModal(){if(this.editModalView=new d(this.editor.locale),this.state.chosen&&Object.keys(this.state.chosen).length>0){let t=this.state.chosen,e=new d(this.editor.locale);e.setTemplate({tag:"label",attributes:{class:"upldFls__details"},children:["Titel"]});let i=new p(this.editor.locale);i.set({value:t.title,placeholder:"Titel",multiline:!0}),i.bind("value").to(()=>t.title),i.on("input",r=>{this.state.chosen.title=r.source.element.value});let s=new d(this.editor.locale);s.setTemplate({tag:"label",attributes:{class:"upldFls__details"},children:["Beschreibung"]});let c=new p(this.editor.locale);c.set({value:t.description,placeholder:"Beschreibung",multiline:!0}),c.bind("value").to(()=>t.description),c.on("input",r=>{this.state.chosen.description=r.source.element.value});let o=new d(this.editor.locale);o.setTemplate({tag:"label",attributes:{class:"upldFls__details"},children:["Alternativer Text"]});let n=new p(this.editor.locale);n.set({value:t.alt_text,placeholder:"Alternativer Text (empfohlen)",multiline:!0}),n.bind("value").to(()=>t.alt_text),n.on("input",r=>{this.state.chosen.alt_text=r.source.element.value});let l=new h(this.editor.locale);l.set({label:"Aktualisieren",withText:!0,class:"upldFls__btnPrimary"}),this.listenTo(l,"execute",()=>{this._editFile()});let a=new h(this.editor.locale);a.set({label:"L\xF6schen",withText:!0,class:"upldFls__btnPrimary upldFls__btnDanger"}),this.listenTo(a,"execute",()=>{this._deleteFile()});let u=new h(this.editor.locale);u.set({label:"close",class:"upldFls__btnIcon",icon:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M16.1404 4.827C16.1407 4.827 16.1411 4.82735 16.1418 4.82807L17.172 5.85843C17.1727 5.85896 17.1729 5.85932 17.1731 5.85985C17.1732 5.86021 17.1732 5.86057 17.1731 5.86093C17.1731 5.86146 17.1727 5.86182 17.172 5.86253L12.0345 11L17.172 16.1375C17.1727 16.1382 17.1729 16.1386 17.1731 16.1391C17.1732 16.1395 17.1732 16.14 17.1731 16.1404C17.1731 16.1407 17.1727 16.1411 17.172 16.1418L16.1416 17.172C16.1411 17.1727 16.1407 17.1729 16.1404 17.1731C16.14 17.1732 16.1395 17.1732 16.1391 17.1731C16.1386 17.1731 16.1382 17.1727 16.1375 17.172L11 12.0345L5.86253 17.172C5.86182 17.1727 5.86146 17.1729 5.86093 17.1731C5.86052 17.1732 5.86008 17.1732 5.85968 17.1731C5.85932 17.1731 5.85896 17.1727 5.85825 17.172L4.82807 16.1416C4.82735 16.1411 4.82718 16.1407 4.827 16.1404C4.82687 16.14 4.82687 16.1395 4.827 16.1391C4.827 16.1386 4.82735 16.1382 4.82807 16.1375L9.96557 11L4.82807 5.86253C4.82735 5.86182 4.82718 5.86146 4.827 5.86093C4.82687 5.86052 4.82687 5.86008 4.827 5.85968C4.827 5.85932 4.82735 5.85896 4.82807 5.85825L5.85843 4.82807C5.85896 4.82735 5.85932 4.82718 5.85968 4.827C5.86008 4.82687 5.86052 4.82687 5.86093 4.827C5.86146 4.827 5.86182 4.82735 5.86253 4.82807L11 9.96557L16.1375 4.82807C16.1382 4.82735 16.1386 4.82718 16.1391 4.827C16.1395 4.82687 16.14 4.82687 16.1404 4.827Z" fill="black" fill-opacity="0.45"/></svg>'}),this.listenTo(u,"execute",()=>{this.editModalView.element.classList.remove("open")}),this.editModalView.setTemplate({tag:"div",attributes:{class:"upldFls__editModalWrapper open"},children:[{tag:"div",attributes:{class:"upldFls__editModalOverlay"},children:[]},{tag:"div",attributes:{class:"upldFls__editModal"},children:[{tag:"div",attributes:{class:"upldFls__editForm"},children:[{tag:"div",attributes:{class:"upldFls__editFormHeader"},children:["Einstellungen zum Bild / Dokument",u]},{tag:"div",attributes:{class:"upldFls__editFormFormField"},children:[e,i]},{tag:"div",attributes:{class:"upldFls__editFormFormField"},children:[s,c]},{tag:"div",attributes:{class:"upldFls__editFormFormField"},children:[o,n]},{tag:"div",attributes:{class:"upldFls__editFormActions"},children:[a,l]}]}]}]})}else this.editModalView.setTemplate({tag:"div",attributes:{class:"upldFls__editModalWrapper"},children:[]})}_updateEditModalView(){this._createEditModal(),this.editModalView&&this.editModalView.isRendered===!1&&this.editModalView.render();let t=this.dialogView.element.querySelector(".upldFls__inner > .upldFls__editModalWrapper");t&&t.replaceWith(this.editModalView.element)}_createMainPanel(t){let e=new d(t);return this.itemsCollection=new C(t),this._createPagination(t),this._updateItemsCollection(),e.setTemplate({tag:"div",attributes:{class:"ckbox-view upldFls__view"},children:[{tag:"div",attributes:{class:"upldFls__viewItems"},children:this.itemsCollection},this.paginationView]}),e}_updateItemsCollection(){if(this.itemsCollection.clear(),this.isLoading){let t=new d(this.editor.locale);t.setTemplate({tag:"div",attributes:{class:"upldFls__loading"},children:[{tag:"p",attributes:{class:""},children:["Wird geladen..."]}]}),this.itemsCollection.add(t)}else if(this.state.items.length===0){let t=new d(this.editor.locale);t.setTemplate({tag:"div",attributes:{class:"upldFls__loading"},children:[{tag:"p",attributes:{class:""},children:["Nothing found."]}]}),this.itemsCollection.add(t)}else this.state.items.forEach(t=>{let e=new g(this.editor.locale,t,this.state.chosen.id);this.listenTo(e,"item:select",(i,s)=>{Object.keys(this.state.chosen).length===0||this.state.chosen.id!==s.id?this.state.chosen=s:this.state.chosen={},this._updateItemsCollection(),this._updateSidebarView()}),this.itemsCollection.add(e)})}_createPagination(t){this.paginationView=new d(t),this.linksCollection=new C(t),this.paginationView.setTemplate({tag:"div",attributes:{class:"upldFls__pagination"},children:this.linksCollection}),this._updatePagination()}_updatePagination(){if(this.linksCollection.clear(),!(this.isLoading||this.state.total_pages<2))for(let t=1;t<=this.state.total_pages;t++){let e=new h(this.editor.locale);e.set({label:t,withText:!0,class:`upldFls__paginationLink ${this.state.page===t?"active":""}`}),this.listenTo(e,"execute",()=>{this.state.page=t,this._fetchFiles({type:this.state.type,search:this.state.search,page:this.state.page})}),this.linksCollection.add(e)}}_handleTypeClick(t){this.state.type=t,this._fetchFiles({type:this.state.type,page:1,search:""})}_handleSearchSubmit(){this._fetchFiles({type:this.state.type,page:1,search:this.state.search})}_fetchFiles(t){this.isLoading=!0,this._updateItemsCollection(),this._updatePagination(),fetch(this.apiGet,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.csrf_token},body:JSON.stringify({...t,editor_id:this.state.editor_id})}).then(e=>e.json()).then(e=>{this.state.total_pages=e.total_pages,this.state.items=e.items}).catch(e=>{alert(e.message)}).finally(()=>{this.isLoading=!1,this._updateItemsCollection(),this._updatePagination()})}_uploadFiles(t){fetch(this.apiUpload[this.state.type],{method:"POST",headers:{"X-CSRF-TOKEN":this.csrf_token},body:t}).then(e=>e.json()).then(e=>{e.error?alert(e.error.message):this.state.items=[e,...this.state.items]}).catch(e=>{alert(e.message)}).finally(()=>{this._updateItemsCollection(),this._updatePagination()})}_editFile(){let t=new FormData;t.append(`${this.state.type}[title]`,this.state.chosen.title),t.append(`${this.state.type}[description]`,this.state.chosen.description),t.append(`${this.state.type}[alt_text]`,this.state.chosen.alt_text),t.append("editor_id",this.state.editor_id),fetch(this.apiPut(this.state.type,this.state.chosen.id),{method:"PATCH",headers:{"X-CSRF-TOKEN":this.csrf_token},body:t}).then(e=>e.json()).then(e=>{if(e.id){this.state.items=this.state.items.map(s=>s.id===e.id?e:s);let i=this.state.items.filter(s=>s.id===e.id);i.length&&(this.state.chosen=i[0])}}).catch(e=>{alert(e.message)}).finally(()=>{this._updateSidebarView(),this._updateItemsCollection()})}_deleteFile(){let t=this.state.chosen.id;fetch(this.apiPut(this.state.type,t),{method:"DELETE",headers:{"X-CSRF-TOKEN":this.csrf_token}}).then(e=>e.json()).then(e=>{e.status&&e.status==="no_content"&&(this.state.items=this.state.items.filter(i=>i.id!==t),this.state.chosen={})}).catch(e=>{alert(e.message)}).finally(()=>{this._updateItemsCollection(),this._updatePagination(),this._updateEditModalView()})}},g=class extends d{constructor(t,e,i=0){super(t),this.item=e,e.data_content_type.startsWith("image/")?this.setTemplate({tag:"div",attributes:{class:`upldFls__item ${i===e.id?"active":""}`},children:[{tag:"div",attributes:{class:"upldFls__itemThumb"},children:[{tag:"img",attributes:{src:e.thumb_url,alt:e.alt_text||"Image",style:{width:"100%",height:"auto"}}}]},{tag:"div",attributes:{class:"upldFls__itemMeta"},children:[{tag:"p",attributes:{class:"upldFls__itemTitle"},children:[e.title||e.data_file_name]},{tag:"span",attributes:{class:"upldFls__itemAlt"},children:[e.alt_text||""]}]}]}):this.setTemplate({tag:"div",attributes:{class:`upldFls__item ${i===e.id?"active":""}`},children:[{tag:"div",attributes:{class:"upldFls__itemThumb file"},children:[{tag:"span",attributes:{class:"upldFls__itemIconType"},children:[`\u{1F4C4}${e.data_content_type}`]}]},{tag:"div",attributes:{class:"upldFls__itemMeta"},children:[{tag:"p",attributes:{class:"upldFls__itemTitle"},children:[e.title||e.data_file_name]},{tag:"p",attributes:{class:"upldFls__itemAlt"},children:[e.alt_text||""]}]}]}),this.on("render",()=>{this.element.addEventListener("click",()=>{this.fire("item:select",e)})})}};window.UploadFilesPlugin=_;})();
